# =========================
# Nginx 配置文件 default.conf
# =========================

# 站点一：主站 kuailemao.xyz
server {
    listen 80;                        # 监听 80 端口 (HTTP)
    server_name kuailemao.xyz;        # 绑定主域名

    # 静态资源配置（前端打包文件）
    location / {
        root   /usr/share/nginx/html; # 前端打包文件存放路径 (dist 部署后放这里)
        index  index.html index.htm;  # 默认首页
        try_files $uri $uri/ /index.html =404;
    }

    # API 代理配置，转发到 Spring Boot
    location /api/ {
        proxy_pass http://8.148.31.90:8088/;   # 后端服务地址
        proxy_set_header Host $host;           # 保留原始 Host
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 音乐 API 代理配置
    location /wapi/ {
        proxy_pass http://kuailemao.xyz:3000/;
    }

    # 自定义 404 页面
    error_page 404 /404.html;
    location = /404.html {
        internal;                       # 不允许直接访问
        root /usr/share/nginx/html;
    }
}

# 站点二：子域名 blog.kuailemao.xyz
server {
    listen 80;
    server_name blog.kuailemao.xyz;

    # 将 blog.kuailemao.xyz 的流量转发到 kuailemao.xyz:81
    location / {
        proxy_pass http://kuailemao.xyz:81/;
        client_max_body_size 100M;               # 上传文件大小限制

        # 保留请求头
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
