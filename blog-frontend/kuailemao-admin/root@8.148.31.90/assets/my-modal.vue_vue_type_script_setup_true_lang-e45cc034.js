import{d as G,ap as J,r as h,j as M,w as X,a as b,a1 as f,a2 as v,a3 as e,c as n,a8 as R,u as C,E as y,ai as Y,a5 as H,F as L,af as Q,ae as W}from"./vue-5b89248e.js";import{t as B,n as Z,s as $}from"./index-2a334394.js";import{m as d,aC as ee,R as te,X as ae,Y as oe,J as ne,U as se,a0 as le,as as re,al as ie}from"./antd-a1128520.js";async function fe(s,l,o){return B("/role/permission/role/list",null,{params:{permissionId:s,roleName:l,roleKey:o}}).catch(u=>d.warn(u))}async function F(s,l,o){return B("/role/permission/not/role/list",null,{params:{permissionId:s,roleName:l,roleKey:o}}).catch(u=>d.warn(u))}async function q(s){return Z("/role/permission/add",s).catch(l=>d.warn(l))}async function ye(s){return $("/role/permission/delete",s).catch(l=>d.warn(l))}const ce={style:{display:"flex"}},de=R("br",null,null,-1),_e=G({__name:"my-modal",props:{open:Boolean,title:String,formData:Object,permissions:Array},emits:["update:close"],setup(s,{emit:l}){const o=s,u=l,p=J(),D=[{title:"角色编号",dataIndex:"id",align:"center"},{title:"角色名称",dataIndex:"roleName",align:"center"},{title:"角色字符",dataIndex:"roleKey",align:"center"},{title:"角色顺序",dataIndex:"orderNum",align:"center"},{title:"状态",dataIndex:"status",align:"center",key:"status"},{title:"创建时间",dataIndex:"createTime",align:"center"}],_=h(!1),K=h([]);async function k(t){_.value=!0;let a=[];if(t){const{data:c}=await F(p.query.id,t.roleName,t.roleKey);a=c}else{const{data:c}=await F(p.query.id);c&&(a=c)}K.value=a,_.value=!1}const x=h();function O(){x.value.resetFields()}const g=M(()=>o.open);X(g,t=>{t&&k()});function S(){u("update:close",!1)}const i=b({selectedRowKeys:[],loading:!1});function P(t){i.selectedRowKeys=t}async function U(){if(i.selectedRowKeys.length>0&&p.query.id){const t={roleId:i.selectedRowKeys,permissionId:[p.query.id]};(await q(t)).code===200&&d.success("授权成功，请重新登录后生效")}if(i.selectedRowKeys.length>0&&o.permissions&&o.permissions.length>0){const t={roleId:i.selectedRowKeys,permissionId:o.permissions};(await q(t)).code===200&&d.success("批量授权成功，请重新登录后生效")}u("update:close",!1,i.selectedRowKeys),i.selectedRowKeys=[]}const m=b({roleKey:void 0,roleName:void 0});function V(){k(m)}function j(){d.error("出现问题")}return(t,a)=>{const c=ae,w=oe,N=ne,E=se,I=le,T=re,z=ie;return f(),v(z,{open:g.value,"onUpdate:open":a[2]||(a[2]=r=>g.value=r),width:"50%",title:s.title,onOk:U,onCancel:S},{default:e(()=>[n(E,{ref_key:"formRef",ref:x,style:{"margin-top":"2rem"},model:m,colon:!1,onSubmit:V,onFinishFailed:j},{default:e(()=>[R("div",ce,[n(w,{label:"角色名称",name:"roleKey",style:{"margin-right":"1rem"}},{default:e(()=>[n(c,{value:m.roleKey,"onUpdate:value":a[0]||(a[0]=r=>m.roleKey=r),placeholder:"请输入角色名称"},null,8,["value"])]),_:1}),n(w,{label:"角色字符",name:"roleName",style:{"margin-right":"2rem"}},{default:e(()=>[n(c,{value:m.roleName,"onUpdate:value":a[1]||(a[1]=r=>m.roleName=r),placeholder:"请输入角色字符",style:{width:"220px"}},null,8,["value"])]),_:1}),n(w,null,{default:e(()=>[n(N,{type:"primary","html-type":"submit"},{icon:e(()=>[n(C(ee))]),default:e(()=>[y(" 搜索 ")]),_:1}),n(N,{style:{"margin-left":"10px"},onClick:O},{icon:e(()=>[n(C(te))]),default:e(()=>[y(" 重置 ")]),_:1})]),_:1})])]),_:1},8,["model"]),n(T,{columns:D,"data-source":K.value,loading:_.value,"row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:P},"row-key":r=>r.id,size:"small"},Y({bodyCell:e(({column:r,record:A})=>[r.key==="status"?(f(),H(L,{key:0},[A.status===0?(f(),v(I,{key:0,color:"green"},{default:e(()=>[y(" 正常 ")]),_:1})):(f(),v(I,{key:1,color:"red"},{default:e(()=>[y(" 停用 ")]),_:1}))],64)):Q("",!0)]),_:2},[o.permissions&&o.permissions.length>0?{name:"footer",fn:e(()=>[R("span",null,"选中的权限编号：【"+W(o.permissions.join(" , "))+"】",1),de]),key:"0"}:void 0]),1032,["data-source","loading","row-selection","row-key"])]),_:1},8,["open","title"])}}});export{_e as _,ye as d,fe as q};
