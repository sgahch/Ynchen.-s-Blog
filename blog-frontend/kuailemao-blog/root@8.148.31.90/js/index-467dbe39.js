import{A as N,r as d,Q as F,f as te,R as ne,o as i,c as u,l as a,i as G,m as S,L as Y,j as T,F as A,p as z,t as L,w as oe,a5 as ce,q as H,k as J,V as de,u as Z}from"./.pnpm-a60ec0da.js";import{_ as O,h as ve}from"./index-f983387b.js";const he={class:"preview-image-container"},pe=["src"],R=.1,j=10,me=.002,ge=N({__name:"PhotoPreview",props:{show:{type:Boolean},photos:{},currentIndex:{}},emits:["update:show","update:currentIndex"],setup(X,{emit:v}){const r=X,h=v,p=d(1),_=d(0),g=d(!1),$=d(!1),f=d(0),w=d(0),y=d(!1),I=d(0),D=d(0),x=d(0),P=d(0),M=d(0),E=d(1),b=d(!1),s=d(""),e=F(()=>p.value===1&&_.value===0&&!g.value&&!$.value&&f.value===0&&w.value===0),t=()=>{p.value=1,_.value=0,g.value=!1,$.value=!1,f.value=0,w.value=0},n=()=>{t();const l=parseInt(document.body.style.top||"0")*-1;document.body.style.position="",document.body.style.width="",document.body.style.top="",document.body.style.left="",document.body.style.marginTop="",document.body.style.overflow="",window.scrollTo(0,l),h("update:show",!1)},o=()=>{if(b.value)return;b.value=!0,s.value="prev",t();const l=r.currentIndex>0?r.currentIndex-1:r.photos.length-1;h("update:currentIndex",l),setTimeout(()=>{s.value="",b.value=!1},300)},c=()=>{if(b.value)return;b.value=!0,s.value="next",t();const l=r.currentIndex<r.photos.length-1?r.currentIndex+1:0;h("update:currentIndex",l),setTimeout(()=>{s.value="",b.value=!1},300)},C=()=>{p.value=Math.min(p.value*1.2,j)},m=()=>{p.value=Math.max(p.value/1.2,R)},U=()=>{_.value-=90},V=()=>{_.value+=90},ae=()=>{g.value=!g.value},se=()=>{$.value=!$.value},q=l=>{r.show&&(l.key==="Escape"?n():l.key==="ArrowLeft"?o():l.key==="ArrowRight"?c():l.key==="+"||l.key==="="?C():l.key==="-"?m():l.key==="r"?V():l.key==="R"?U():l.key==="0"&&t())},le=l=>{y.value=!0,I.value=l.clientX,D.value=l.clientY,x.value=f.value,P.value=w.value},K=l=>{if(!y.value)return;const k=l.clientX-I.value,B=l.clientY-D.value;e.value&&p.value===1?Math.abs(k)>50&&(k>0?o():c(),y.value=!1):(f.value=x.value+k,w.value=P.value+B)},W=()=>{y.value=!1},re=l=>{l.touches.length===1?(y.value=!0,I.value=l.touches[0].clientX,D.value=l.touches[0].clientY,x.value=f.value,P.value=w.value):l.touches.length===2&&(M.value=Math.hypot(l.touches[0].clientX-l.touches[1].clientX,l.touches[0].clientY-l.touches[1].clientY),E.value=p.value)},ie=l=>{if(l.touches.length===1&&y.value){const k=l.touches[0].clientX-I.value,B=l.touches[0].clientY-D.value;e.value&&p.value===1?Math.abs(k)>50&&(k>0?o():c(),y.value=!1):(f.value=x.value+k,w.value=P.value+B)}else if(l.touches.length===2){const B=Math.hypot(l.touches[0].clientX-l.touches[1].clientX,l.touches[0].clientY-l.touches[1].clientY)/M.value;p.value=Math.min(Math.max(E.value*B,R),j)}},Q=()=>{y.value=!1},ue=l=>{l.preventDefault();const k=-l.deltaY*me,B=p.value*(1+k);p.value=Math.min(Math.max(B,R),j)};return te(()=>{window.addEventListener("mousemove",K),window.addEventListener("mouseup",W),window.addEventListener("keydown",q)}),ne(()=>{window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",W),window.removeEventListener("keydown",q)}),(l,k)=>l.show?(i(),u("div",{key:0,class:"preview-modal",onClick:n},[a("button",{class:"close-btn",onClick:n},"×"),a("div",{class:"preview-content",onClick:k[1]||(k[1]=Y(()=>{},["stop"]))},[a("div",he,[a("div",{class:"drag-container",style:G({transform:`translate(${f.value}px, ${w.value}px)`})},[(i(),u("img",{key:l.currentIndex,src:l.photos[l.currentIndex],style:G({transform:`scale(${p.value}) rotate(${_.value}deg) 
                         scaleX(${g.value?-1:1}) scaleY(${$.value?-1:1})`,transformOrigin:"center",transition:"transform 0.3s ease"}),class:S(["preview-image",s.value==="prev"?"slide-prev":"",s.value==="next"?"slide-next":""]),onMousedown:le,onWheel:Y(ue,["prevent"]),onTouchstart:Y(re,["prevent"]),onTouchmove:Y(ie,["prevent"]),onTouchend:Y(Q,["prevent"]),onTouchcancel:Y(Q,["prevent"]),onDragstart:k[0]||(k[0]=Y(()=>{},["prevent"])),draggable:"false",alt:"预览图片"},null,46,pe))],4)]),a("div",{class:"preview-toolbar"},[a("div",{class:"toolbar-group"},[a("button",{class:"preview-btn",onClick:o,title:"上一张"},"◀"),a("button",{class:"preview-btn",onClick:c,title:"下一张"},"▶")]),a("div",{class:"toolbar-group"},[a("button",{class:"preview-btn",onClick:C,title:"放大"},"+"),a("button",{class:"preview-btn",onClick:m,title:"缩小"},"-"),a("button",{class:"preview-btn",onClick:U,title:"向左旋转"},"↺"),a("button",{class:"preview-btn",onClick:V,title:"向右旋转"},"↻"),a("button",{class:"preview-btn",onClick:ae,title:"水平翻转"},"↔"),a("button",{class:"preview-btn",onClick:se,title:"垂直翻转"},"↕"),a("button",{class:"preview-btn",onClick:t,title:"重置"},"⟲")])])])])):T("",!0)}});const ye=O(ge,[["__scopeId","data-v-d7ef11b2"]]),fe={class:"breadcrumb-nav"},be=["onClick"],_e={class:"banner-content"},ke={class:"banner-text"},we={class:"banner-title"},Pe={key:0,class:"banner-description"},Ce={class:"banner-stats"},$e={class:"stats-group"},xe={key:0,class:"stats-item photos-count"},Me={key:1,class:"stats-item albums-count"},Ie=N({__name:"AlbumBanner",props:{title:{},description:{},coverImage:{},photosCount:{},albumsCount:{},breadcrumbs:{},isDarkMode:{type:Boolean}},emits:["breadcrumbClick"],setup(X,{emit:v}){const r=v,h=X;return(p,_)=>(i(),u("div",{class:S(["album-banner",{"dark-mode":h.isDarkMode}])},[a("div",{class:"banner-background",style:G({backgroundImage:h.coverImage?`url(${h.coverImage})`:"linear-gradient(45deg, #2c3e50, #3498db)"})},null,4),a("div",fe,[a("span",{class:"breadcrumb-item home",onClick:_[0]||(_[0]=g=>r("breadcrumbClick",-1))},"首页"),(i(!0),u(A,null,z(h.breadcrumbs,(g,$)=>(i(),u(A,{key:g.id},[_[1]||(_[1]=a("span",{class:"breadcrumb-separator"},"/",-1)),a("span",{class:"breadcrumb-item",onClick:f=>r("breadcrumbClick",$)},L(g.name),9,be)],64))),128))]),a("div",_e,[a("div",ke,[a("h1",we,L(h.title),1),h.description?(i(),u("p",Pe,L(h.description),1)):T("",!0),a("div",Ce,[a("div",$e,[h.photosCount!==void 0?(i(),u("span",xe,L(h.photosCount)+" 张照片 ",1)):T("",!0),h.albumsCount!==void 0?(i(),u("span",Me,L(h.albumsCount)+" 个相册 ",1)):T("",!0)])])])])],2))}});const De=O(Ie,[["__scopeId","data-v-2fe8ca74"]]),Se={class:"gallery-wrapper"},Te={key:0,class:"loading-state"},Ye={key:0,class:"gallery-grid"},Le=["onClick"],Xe={key:0,class:"default-album-cover"},Ae=["data-src","alt"],Be=["data-src","alt"],Ee={key:2,class:"item-info"},Ge={key:1,class:"empty-state"},Ue={key:2,class:"loading-more"},ze={key:0,class:"loading-spinner"},Fe={key:1},Ne=N({__name:"PhotoGallery",props:{currentPath:{},galleries:{},isDarkMode:{type:Boolean},loading:{type:Boolean},hasMore:{type:Boolean}},emits:["update:currentPath","loadMore"],setup(X,{emit:v}){const r=X,h=v,p=d(!1),_=d(0),g=d([]),$=e=>{if(b(e)){const t=window.scrollY;document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${t}px`,document.body.style.overflow="hidden",document.body.style.left="0",document.body.style.marginTop="0";const n=y().filter(b).map(o=>o.data.url);g.value=n,_.value=n.indexOf(e.data.url),p.value=!0}else s(e)&&h("update:currentPath",[...r.currentPath,e.data.id])},f=d([]),w=d(0),y=()=>{const e=r.currentPath.length===0?"root":r.currentPath[r.currentPath.length-1].toString();return r.galleries[e]||[]},I=(e=0)=>{const t=y();f.value.length<t.length&&(f.value=[...f.value,...new Array(t.length-f.value.length).fill(!1)]),requestAnimationFrame(()=>{for(let n=e;n<t.length;n++)setTimeout(()=>{f.value[n]=!0},(n-e)*100)})},D=()=>{const e=window.scrollY+window.innerHeight,t=document.documentElement.scrollHeight;!r.loading&&r.hasMore&&t-e<=100&&h("loadMore")};te(()=>{I(),window.addEventListener("scroll",D)}),ne(()=>{document.body.style.position="",document.body.style.width="",document.body.style.top="",document.body.style.overflow="",document.body.style.left="",document.body.style.marginTop="",window.removeEventListener("scroll",D)}),oe(()=>[r.currentPath,r.galleries],(e,t)=>{const n=y();(t&&t[0]?r.currentPath.length!==t[0].length||r.currentPath.some((c,C)=>c!==t[0][C])||r.currentPath.length===0&&t[0].length>0:!1)?(window.scrollTo({top:0,behavior:"smooth"}),f.value=new Array(n.length).fill(!1),I(0)):n.length>w.value&&I(w.value),w.value=n.length},{deep:!0,immediate:!0});const x=e=>s(e)?e.data.photos.length>0||!!e.data.coverUrl:!1,P=F(()=>{const e=r.currentPath.length===0?"root":r.currentPath[r.currentPath.length-1].toString(),t=r.galleries[e]||[];let n;if(e==="root"){const o=t.find(c=>b(c));return{title:"我的相册",description:"相册功能正在测试阶段，图片来源于网络，如有侵权请联系我！！！",photosCount:t.filter(c=>b(c)).length,albumsCount:t.filter(c=>s(c)).length,coverImage:o?o.data.url:void 0}}else{const o=r.currentPath.length>1?r.currentPath[r.currentPath.length-2].toString():"root";n=(r.galleries[o]||[]).find(m=>s(m)&&m.data.id===Number(e));const C=t.find(m=>b(m));return{title:(n==null?void 0:n.data.name)||"未命名相册",description:(n==null?void 0:n.data.description)||"",photosCount:t.filter(m=>b(m)).length,albumsCount:t.filter(m=>s(m)).length,coverImage:C?C.data.url:void 0}}}),M=F(()=>r.currentPath.map((e,t)=>{const n=t===0?"root":r.currentPath[t-1].toString(),c=(r.galleries[n]||[]).find(C=>s(C)&&C.data.id===e);return{id:e,name:c?c.data.name:"未命名相册"}})),E=e=>{e===-1?h("update:currentPath",[]):h("update:currentPath",r.currentPath.slice(0,e+1))},b=e=>e.type==="photo",s=e=>e.type==="album";return(e,t)=>{const n=ce("lazy");return i(),u("div",{class:S(["photo-gallery",{"dark-mode":e.isDarkMode}])},[H(De,{title:P.value.title,description:P.value.description,"photos-count":P.value.photosCount,"albums-count":P.value.albumsCount,"cover-image":P.value.coverImage,breadcrumbs:M.value,"is-dark-mode":e.isDarkMode,onBreadcrumbClick:E},null,8,["title","description","photos-count","albums-count","cover-image","breadcrumbs","is-dark-mode"]),a("div",Se,[r.loading&&y().length===0?(i(),u("div",Te,t[2]||(t[2]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"加载中...",-1)]))):(i(),u(A,{key:1},[y().length>0?(i(),u("div",Ye,[(i(!0),u(A,null,z(y(),(o,c)=>(i(),u("div",{key:o.type+(b(o),o.data.id),class:S(["gallery-item",{visible:f.value[c]}]),onClick:C=>$(o)},[s(o)?(i(),u(A,{key:0},[!x(o)&&!o.data.coverUrl?(i(),u("div",Xe,t[3]||(t[3]=[a("div",{class:"default-album-inner"},[a("div",{class:"album-icon"})],-1)]))):J((i(),u("img",{key:1,"data-src":o.data.coverUrl||"/images/default-album-cover.jpg",alt:o.data.name},null,8,Ae)),[[n,!0]])],64)):b(o)?J((i(),u("img",{key:1,"data-src":o.data.url,alt:o.data.title},null,8,Be)),[[n,!0]]):T("",!0),s(o)?(i(),u("div",Ee,[a("h3",null,L(o.data.name),1)])):T("",!0)],10,Le))),128))])):(i(),u("div",Ge,t[4]||(t[4]=[a("p",null,"这个相册还没有内容哦~",-1)]))),r.hasMore&&y().length>0?(i(),u("div",Ue,[r.loading?(i(),u("div",ze)):(i(),u("p",Fe,"向下滚动加载更多"))])):T("",!0)],64))]),H(ye,{show:p.value,"onUpdate:show":t[0]||(t[0]=o=>p.value=o),currentIndex:_.value,"onUpdate:currentIndex":t[1]||(t[1]=o=>_.value=o),photos:g.value},null,8,["show","currentIndex","photos"])],2)}}});const Oe=O(Ne,[["__scopeId","data-v-37a42c82"]]);function Re(X){return ve({url:"/photo/list",method:"get",params:X})}const je={class:"header"},He={class:"header-content"},Ve={class:"main-content"},qe={class:"album-tree"},Ke=["onClick"],We={class:"album-name"},Qe={key:0,class:"sub-albums"},Je=["onClick"],Ze={class:"album-name"},et={key:0,class:"sub-albums"},tt=["onClick"],nt={class:"album-name"},ot={class:"gallery-container"},ee=16,at=N({__name:"index",setup(X){const v=d([]),r=d(!1),h=d(1),p=d(!0),_=d(0),g=d({root:[]}),$=s=>s.map(e=>e.type===1?{type:"album",data:{id:e.id,name:e.name,description:e.description||"",photos:[],coverUrl:e.url}}:{type:"photo",data:{id:e.id,url:e.url||"",title:e.name,description:e.description||""}}),f=async(s,e=1,t=!1)=>{try{r.value=!0;const n=await Re({pageNum:e,pageSize:ee,parentId:s||null}),o=s?s.toString():"root",c=$(n.data.page);t?g.value[o]=[...g.value[o]||[],...c]:g.value[o]=c,_.value=n.data.total,p.value=e*ee<n.data.total,h.value=e}catch(n){console.error("加载相册数据失败:",n)}finally{r.value=!1}},w=async()=>{if(r.value||!p.value)return;const s=v.value.length>0?v.value[v.value.length-1]:void 0;await f(s,h.value+1,!0)};oe(()=>v.value,async s=>{const e=s.length>0?s[s.length-1]:void 0;h.value=1,p.value=!0,await f(e,1,!1)},{immediate:!0});const y=s=>{if(v.value[v.value.length-1]===s)return;const e=I(s);e?v.value=e:v.value=[s]},I=(s,e=[])=>{for(const t of g.value.root)if(t.type==="album"){const n=t.data;if(n.id===s)return[s];const o=D(n.id,s);if(o)return o}return null},D=(s,e)=>{const t=g.value[s.toString()];if(!t)return null;for(const n of t)if(n.type==="album"){const o=n.data;if(o.id===e)return[s,e];const c=D(o.id,e);if(c)return[s,...c]}return null},x=d(!1),P=s=>{x.value=s,s?document.body.style.overflow="hidden":document.body.style.overflow=""},M=()=>{P(!1)},E=F(()=>{const s=(e=null,t=0)=>{const n=[];for(const[o,c]of Object.entries(g.value)){const C=c.filter(m=>m.type==="album").map(m=>{const U=m.data;return{id:U.id,name:U.name}});for(const m of C)e===null&&o==="root"?n.push({id:m.id,name:m.name,children:s(m.id.toString(),t+1),level:t}):e===o&&n.push({id:m.id,name:m.name,children:s(m.id.toString(),t+1),level:t})}return n};return s()}),b=de();return(s,e)=>(i(),u("div",{class:S(["app-container",{"dark-mode":Z(b)}])},[a("header",je,[a("div",He,[a("button",{class:"menu-toggle",onClick:e[0]||(e[0]=t=>P(!x.value))},e[3]||(e[3]=[a("span",{class:"menu-icon"},null,-1)]))])]),a("main",Ve,[a("aside",{class:S(["album-menu",{"mobile-open":x.value}])},[a("div",{class:"menu-header"},[e[4]||(e[4]=a("h2",null,"相册列表",-1)),a("button",{class:"close-menu",onClick:M},"×")]),a("ul",qe,[a("li",{class:S(["home-item",{active:v.value.length===0}]),onClick:e[1]||(e[1]=t=>{v.value=[],M()})}," 主页 ",2),(i(!0),u(A,null,z(E.value,t=>(i(),u("li",{key:t.id,class:S(["album-tree-item",{active:v.value[v.value.length-1]===t.id,"has-children":t.children.length>0,expanded:v.value.includes(t.id)}]),style:G({paddingLeft:`${t.level*16}px`}),onClick:n=>{y(t.id),M()}},[a("span",We,L(t.name),1),t.children.length>0?(i(),u("ul",Qe,[(i(!0),u(A,null,z(t.children,n=>(i(),u("li",{key:n.id,class:S(["album-tree-item",{active:v.value[v.value.length-1]===n.id,"has-children":n.children.length>0,expanded:v.value.includes(n.id)}]),style:G({paddingLeft:`${n.level*16}px`}),onClick:Y(o=>{y(n.id),M()},["stop"])},[a("span",Ze,L(n.name),1),n.children.length>0?(i(),u("ul",et,[(i(!0),u(A,null,z(n.children,o=>(i(),u("li",{key:o.id,class:S(["album-tree-item",{active:v.value[v.value.length-1]===o.id}]),style:G({paddingLeft:`${o.level*16}px`}),onClick:Y(c=>{y(o.id),M()},["stop"])},[a("span",nt,L(o.name),1)],14,tt))),128))])):T("",!0)],14,Je))),128))])):T("",!0)],14,Ke))),128))])],2),x.value?(i(),u("div",{key:0,class:"overlay",onClick:M})):T("",!0),a("div",ot,[H(Oe,{currentPath:v.value,"onUpdate:currentPath":e[2]||(e[2]=t=>v.value=t),galleries:g.value,"is-dark-mode":Z(b),loading:r.value,"has-more":p.value,onLoadMore:w},null,8,["currentPath","galleries","is-dark-mode","loading","has-more"])])])],2))}});const rt=O(at,[["__scopeId","data-v-06628ca7"]]);export{rt as default};
