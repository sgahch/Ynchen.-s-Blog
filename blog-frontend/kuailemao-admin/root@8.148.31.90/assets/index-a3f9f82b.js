import{_ as ee}from"./index-0deb4903.js";import{t as ne,n as K,s as te,_ as ae}from"./index-2a334394.js";import{m as h,X as oe,Y as le,S as se,y as ce,J as ie,ar as de,z as ue,a0 as pe,aq as me,x as _e,as as re}from"./antd-a1128520.js";import{d as fe,h as he,r as C,a as ye,o as ge,a0 as w,a1 as f,a2 as y,a3 as e,c as t,u as c,E as u,a8 as v,a5 as ke,F as ve,af as g,ae as k,a6 as xe,a7 as Ce}from"./vue-5b89248e.js";import"./index.vue_vue_type_script_setup_true_lang-be6d18e9.js";import"./chunk-YXBPAIHU-f2871816.js";import"./context-6a3352c8.js";async function Ie(){return ne("/comment/back/list").catch(d=>h.warn(d))}async function we(d){return K("/comment/back/search",d).catch(_=>h.warn(_))}async function be(d){return K("/comment/back/isCheck",d).catch(_=>h.warn(_))}async function Ue(d){return te(`/comment/back/delete/${d}`).catch(_=>h.warn(_))}const R=d=>(xe("data-v-edc5ed3a"),d=d(),Ce(),d),$e=["href"],Fe=R(()=>v("span",{style:{"margin-inline-start":"1px"}},"跳转",-1)),Ne=R(()=>v("span",{style:{"margin-left":"3px"}},"删除",-1)),Oe=fe({__name:"index",setup(d,{expose:_}){_({h:he});const x=C(!0),p=ye({commentUserName:"",commentContent:"",type:void 0,isCheck:void 0}),F=C(),b=C([]);async function S(a){x.value=!0;const{data:n}=await we(a);x.value=!1,b.value=O(n)}function L(a){console.log("出现错误:",a)}const T=C([{title:"编号",dataIndex:"id",align:"center"},{title:"评论类型",dataIndex:"type",align:"center"},{title:"类型编号",dataIndex:"typeId",align:"center"},{title:"评论内容",dataIndex:"commentContent",align:"center"},{title:"评论用户",dataIndex:"commentUserName",align:"center"},{title:"是否通过",dataIndex:"isCheck",align:"center"},{title:"评论时间",dataIndex:"createTime",align:"center"},{title:"操作",key:"operation",align:"center"}]);ge(()=>{N()});async function N(){const{data:a}=await Ie();F.value=a,b.value=O(a),x.value=!1}function O(a){const n=a.filter(o=>o.parentId===null);return n.forEach(o=>{o.key=o.id,o.isCheck=o.isCheck===1;const l=A(o,a);l.length>0&&(o.children=l)}),n}function A(a,n){const o=n.filter(l=>l.parentId===a.id);return o.forEach(l=>{l.key=l.id,l.isCheck=l.isCheck===1;const r=A(l,n);r.length>0&&(l.children=r)}),o}const m=C({expandedRowKeys:[],flag:!1});function V(){m.value.flag?(m.value.expandedRowKeys=[],m.value.flag=!1):(m.value.expandedRowKeys=F.value.map(a=>a.id),m.value.flag=!0)}function M(a,n){if(a)m.value.expandedRowKeys.push(n.key);else{const o=m.value.expandedRowKeys.indexOf(n.key);o>-1&&m.value.expandedRowKeys.splice(o,1)}}function U(){x.value=!0,N()}function Y(a,n,o){o.isCheckloading=!0,n=n?1:0,be({id:a,isCheck:n}).then(l=>{l.code===200&&(h.success("操作成功，相关子评论将变成同一状态"),o.isCheckloading=!1,U())})}async function q(a){Ue(a).then(n=>{n.code===200&&(h.success("删除成功"),U())})}const B="http://localhost:99";return(a,n)=>{const o=oe,l=le,r=se,D=ce,z=w("VerticalAlignBottomOutlined"),I=ie,G=w("ArrowsAltOutlined"),J=w("LinkOutlined"),P=w("DeleteOutlined"),X=de,j=ue,E=pe,H=me,Q=_e,W=re,Z=ee;return f(),y(Z,{"form-state":c(p),"onUpdate:refreshFunc":U,"onUpdate:onFinish":S,"onUpdate:onFinishFailed":L},{"form-items":e(()=>[t(l,{label:"评论用户",name:"commentUserName"},{default:e(()=>[t(o,{value:c(p).commentUserName,"onUpdate:value":n[0]||(n[0]=i=>c(p).commentUserName=i),placeholder:"请输入评论用户"},null,8,["value"])]),_:1}),t(l,{label:"评论内容",name:"commentContent"},{default:e(()=>[t(o,{value:c(p).commentContent,"onUpdate:value":n[1]||(n[1]=i=>c(p).commentContent=i),placeholder:"请输入评论内容"},null,8,["value"])]),_:1}),t(l,{label:"评论类型",name:"type",style:{width:"240px"}},{default:e(()=>[t(D,{value:c(p).type,"onUpdate:value":n[2]||(n[2]=i=>c(p).type=i),placeholder:"评论类型"},{default:e(()=>[t(r,{value:1},{default:e(()=>[u(" 文章 ")]),_:1}),t(r,{value:2},{default:e(()=>[u(" 留言 ")]),_:1})]),_:1},8,["value"])]),_:1}),t(l,{label:"是否通过",name:"isCheck",style:{width:"240px"}},{default:e(()=>[t(D,{value:c(p).isCheck,"onUpdate:value":n[3]||(n[3]=i=>c(p).isCheck=i),placeholder:"是否通过"},{default:e(()=>[t(r,{value:1},{default:e(()=>[u(" 是 ")]),_:1}),t(r,{value:0},{default:e(()=>[u(" 否 ")]),_:1})]),_:1},8,["value"])]),_:1})]),"operate-btn":e(()=>[v("div",null,[t(I,{class:"orange",onClick:n[4]||(n[4]=i=>c(h).warn("别点了，有空再写"))},{icon:e(()=>[t(z)]),default:e(()=>[u(" 导出 ")]),_:1}),t(I,{type:"dashed",style:{"margin-bottom":"10px",color:"grey"},onClick:V},{icon:e(()=>[t(G)]),default:e(()=>[u(" 展开/折叠 ")]),_:1})])]),"table-content":e(()=>[v("div",null,[t(W,{columns:c(T),"data-source":c(b),"expanded-row-keys":c(m).expandedRowKeys,loading:c(x),onExpand:M},{bodyCell:e(({column:i,record:s})=>[i.key==="operation"?(f(),ke(ve,{key:0},[v("a",{href:s.type===1?`${c(B)}article/${s.typeId}`:`${c(B)}message/detail/${s.typeId}`,target:"_blank"},[t(I,{type:"link",style:{padding:"0"}},{icon:e(()=>[t(J)]),default:e(()=>[Fe]),_:1})],8,$e),t(X,{title:"是否确定删除","ok-text":"Yes","cancel-text":"No",onConfirm:$=>q(s.id)},{default:e(()=>[t(I,{type:"link",style:{padding:"0"}},{icon:e(()=>[t(P)]),default:e(()=>[Ne]),_:1})]),_:2},1032,["onConfirm"])],64)):g("",!0),i.dataIndex==="isCheck"?(f(),y(j,{key:1,checked:s.isCheck,"onUpdate:checked":$=>s.isCheck=$,"checked-children":"是","un-checked-children":"否",loading:s.isCheckloading,onChange:$=>Y(s.id,s.isCheck,s)},null,8,["checked","onUpdate:checked","loading","onChange"])):g("",!0),i.dataIndex==="type"?(f(),y(E,{key:2,color:"blue"},{default:e(()=>[u(k(s.type===1?"文章":"留言"),1)]),_:2},1024)):g("",!0),i.dataIndex==="typeId"?(f(),y(E,{key:3},{default:e(()=>[u(k(s.typeId),1)]),_:2},1024)):g("",!0),i.dataIndex==="commentContent"?(f(),y(H,{key:4,title:"评论"},{content:e(()=>[u(k(s.commentContent),1)]),default:e(()=>[u(" "+k(s.commentContent.length>10?`${s.commentContent.substring(0,10)}...`:s.commentContent),1)]),_:2},1024)):g("",!0),i.dataIndex==="createTime"?(f(),y(Q,{key:5,placement:"top"},{title:e(()=>[v("span",null,k(s.createTime),1)]),default:e(()=>[u(" "+k(s.createTime.split(" ")[0])+"... ",1)]),_:2},1024)):g("",!0)]),_:1},8,["columns","data-source","expanded-row-keys","loading"])])]),_:1},8,["form-state"])}}});const Le=ae(Oe,[["__scopeId","data-v-edc5ed3a"]]);export{Le as default};
