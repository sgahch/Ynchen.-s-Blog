import{_ as P}from"./index-0deb4903.js";import X from"./detail-modal-0570f4ef.js";import{a as Q,u as W,b as Z,c as ee,d as te}from"./index-d39a2e87.js";import{m as f,al as ae,am as ne,X as se,Y as oe,S as le,y as ie,an as de,J as ce,A as re,z as ue,a0 as pe,as as me}from"./antd-a1128520.js";import{d as _e,a as R,r as g,o as fe,j as ge,a0 as y,a1 as m,a2 as v,a3 as n,c as t,u as o,E as k,af as x,ae as ye,a5 as ve,F as ke,aj as be,a8 as h}from"./vue-5b89248e.js";import"./index.vue_vue_type_script_setup_true_lang-be6d18e9.js";import"./index-2a334394.js";import"./chunk-YXBPAIHU-f2871816.js";import"./context-6a3352c8.js";const we=h("span",null,"详细",-1),De=h("span",{style:{"margin-inline-start":"1px"}},"详情",-1),xe=h("span",{style:{"margin-inline-start":"1px"}},"删除",-1),he=h("span",{style:{"margin-inline-start":"1px"}},"分配角色",-1),Ye=_e({__name:"index",setup(Ce){const d=R({username:void 0,email:void 0,isDisable:void 0,time:void 0}),S=[{title:"用户编号",dataIndex:"id",align:"center"},{title:"用户头像",dataIndex:"avatar",align:"center"},{title:"用户名称",dataIndex:"username",align:"center"},{title:"用户邮箱",dataIndex:"email",align:"center"},{title:"状态",dataIndex:"isDisable",align:"center",key:"status"},{title:"注册方式",dataIndex:"registerType",align:"center"},{title:"登录地址",dataIndex:"loginAddress",align:"center"},{title:"创建时间",dataIndex:"createTime",align:"center"},{title:"操作",dataIndex:"operation",key:"operation",align:"center"}],b=g(!1),w=g([]);fe(()=>{D()});async function D(a){b.value=!0;let e;if(a)e=a;else{const{data:l}=await Q();e=l}e&&e.length>0&&(e=e.map(l=>{switch(l.isDisable=l.isDisable===0,l.registerType){case 0:l.registerType="邮箱/用户名";break;case 1:l.registerType="Gitee";break;case 2:l.registerType="Github";break;default:l.registerType="未知";break}return l})),w.value=e,b.value=!1}async function $(a){const e={...a};a.time&&a.time[0]&&Object.assign(e,{createTimeStart:a.time[0].format("YYYY-MM-DD HH:mm:ss")}),a.time&&a.time[1]&&Object.assign(e,{createTimeEnd:a.time[1].format("YYYY-MM-DD HH:mm:ss")}),b.value=!0;const{data:l}=await W(e);await D(l)}async function Y(a,e){(await Z(a,e?0:1).catch(u=>{f.warn(u),w.value=w.value.map(r=>(a===r.id&&setTimeout(()=>{r.isDisable=!r.isDisable},500),r))})).code===200&&(e?f.success("已启用"):f.info("已停用"))}const c=R({selectedRowKeys:[],loading:!1}),B=ge(()=>c.selectedRowKeys.length>0&&c.selectedRowKeys.length===1);function F(a){c.selectedRowKeys=a}function T(a){ae.confirm({title:"注意",icon:t(ne),content:`确定删除编号为 【${a.join(",")}】 的角色吗？`,okText:"确认",cancelText:"取消",onOk:()=>{ee(a).then(e=>{e.code===200&&(f.success("删除成功"),c.selectedRowKeys=[],D())})}})}const C=g(!1),I=g(),O=g(!1);async function K(a){a||(a=c.selectedRowKeys[0]),C.value=!0;const{data:e}=await te(a);I.value=e}function V(){C.value=!1,I.value=void 0}return(a,e)=>{const l=se,u=oe,r=le,j=ie,A=de,M=y("SolutionOutlined"),p=ce,U=y("DeleteOutlined"),N=y("VerticalAlignBottomOutlined"),E=y("InsertModal"),H=re,z=ue,q=pe,G=y("KeyOutlined"),J=me,L=P;return m(),v(L,{"form-state":o(d),"onUpdate:refreshFunc":D,"onUpdate:onFinish":$},{"form-items":n(()=>[t(u,{label:"用户名称",name:"username"},{default:n(()=>[t(l,{value:o(d).username,"onUpdate:value":e[0]||(e[0]=s=>o(d).username=s),placeholder:"请输入用户名称",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{label:"用户邮箱",name:"email"},{default:n(()=>[t(l,{value:o(d).email,"onUpdate:value":e[1]||(e[1]=s=>o(d).email=s),placeholder:"请输入用户邮箱",style:{width:"250px"}},null,8,["value"])]),_:1}),t(u,{label:"状态",name:"isDisable",style:{width:"240px"}},{default:n(()=>[t(j,{value:o(d).isDisable,"onUpdate:value":e[2]||(e[2]=s=>o(d).isDisable=s),placeholder:"用户状态"},{default:n(()=>[t(r,{value:0},{default:n(()=>[k(" 正常 ")]),_:1}),t(r,{value:1},{default:n(()=>[k(" 停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),t(u,{label:"创建时间",name:"time"},{default:n(()=>[t(A,{value:o(d).time,"onUpdate:value":e[3]||(e[3]=s=>o(d).time=s),placeholder:["开始时间","结束时间"]},null,8,["value"])]),_:1})]),"operate-btn":n(()=>[t(p,{class:"light-blue",disabled:!o(B),onClick:e[4]||(e[4]=s=>K())},{icon:n(()=>[t(M)]),default:n(()=>[we]),_:1},8,["disabled"]),t(p,{type:"dashed",danger:"",ghost:"",disabled:!(o(c).selectedRowKeys.length>0),onClick:e[5]||(e[5]=s=>T(o(c).selectedRowKeys))},{icon:n(()=>[t(U)]),default:n(()=>[k(" 删除 ")]),_:1},8,["disabled"]),t(p,{class:"orange",onClick:e[6]||(e[6]=s=>o(f).warn("别点了，有空再写"))},{icon:n(()=>[t(N)]),default:n(()=>[k(" 导出 ")]),_:1})]),"table-content":n(()=>[t(X,{"modal-open":o(C),data:o(I),"onUpdate:close:modal":V},null,8,["modal-open","data"]),t(E,{"modal-open":o(O),"onUpdate:close:modal":e[7]||(e[7]=s=>O.value=!1)},null,8,["modal-open"]),t(J,{columns:S,"data-source":o(w),loading:o(b),"row-selection":{selectedRowKeys:o(c).selectedRowKeys,onChange:F},"row-key":s=>s.id,size:"small"},{bodyCell:n(({column:s,record:i})=>[s.dataIndex==="avatar"?(m(),v(H,{key:0,shape:"square",size:"large",src:i.avatar,alt:"无法显示头像"},null,8,["src"])):x("",!0),s.dataIndex==="isDisable"?(m(),v(z,{key:1,checked:i.isDisable,"onUpdate:checked":_=>i.isDisable=_,onChange:_=>Y(i.id,i.isDisable)},null,8,["checked","onUpdate:checked","onChange"])):x("",!0),s.dataIndex==="registerType"?(m(),v(q,{key:2,color:"blue"},{default:n(()=>[k(ye(i.registerType),1)]),_:2},1024)):x("",!0),s.key==="operation"?(m(),ve(ke,{key:3},[t(p,{type:"link",style:{padding:"0"},onClick:_=>K(i.id)},{icon:n(()=>[t(M)]),default:n(()=>[De]),_:2},1032,["onClick"]),t(p,{type:"link",style:{padding:"0","margin-left":"5px"},onClick:_=>T([i.id])},{icon:n(()=>[t(U)]),default:n(()=>[xe]),_:2},1032,["onClick"]),t(p,{type:"link",style:{padding:"0","margin-left":"5px"},onClick:_=>a.$router.push({path:"/user/role",query:{id:i.id,name:i.roleName}})},{icon:n(()=>[t(G)]),default:n(()=>[he]),_:2},1032,["onClick"])],64)):s.key==="icon"?(m(),v(be(i.icon),{key:4})):x("",!0)]),_:1},8,["data-source","loading","row-selection","row-key"])]),_:1},8,["form-state"])}}});export{Ye as default};
