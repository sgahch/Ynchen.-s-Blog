import{_ as le}from"./index-0deb4903.js";import{d as se,r as x,o as ie,a as Y,j as de,w as ue,a0 as b,a1 as k,a2 as w,a3 as t,c as n,u as a,E as p,q as re,ai as ce,z as pe,ae as I,af as O,a8 as B,a5 as me,F as _e,aj as fe}from"./vue-5b89248e.js";import{n as H,q as ge,s as ye}from"./index-2a334394.js";import{m as g,ak as ve,al as U,am as ke,d as S,X as xe,Y as we,an as he,S as be,y as Ie,J as Ce,ao as De,ap as Te,af as Ye,a0 as Oe,aq as Se,ar as Be,as as Ne}from"./antd-a1128520.js";import{u as Re}from"./index-d39a2e87.js";import"./index.vue_vue_type_script_setup_true_lang-be6d18e9.js";import"./chunk-YXBPAIHU-f2871816.js";import"./context-6a3352c8.js";async function Fe(_){return H("/blackList/getBlackListing",_).catch(d=>g.warn(d))}async function Ke(_){return ge("/blackList/update",_)}async function Le(_){return H("/blackList/add",_)}async function $(_){return ye("/blackList/delete",JSON.stringify(_))}const Me={style:{maxWidth:"300px",wordBreak:"break-all"}},Ue=B("span",{style:{"margin-inline-start":"1px"}},"修改",-1),$e=B("span",{style:{"margin-inline-start":"1px"}},"删除",-1),Je=se({__name:"index",setup(_){const d=x({userName:"",time:["",""],reason:"",type:void 0}),P=[{title:"名单编号",dataIndex:"id",align:"center"},{title:"用户名称",dataIndex:"userName",align:"center"},{title:"封禁时间",dataIndex:"bannedTime",align:"center"},{title:"解封时间",dataIndex:"expiresTime",align:"center"},{title:"封禁类型",dataIndex:"type",align:"center"},{title:"封禁理由",dataIndex:"reason",align:"center"},{title:"更新时间",dataIndex:"updateTime",align:"center"},{title:"操作",dataIndex:"operation",key:"operation",align:"center"}],h=x(!1),C=x([]);ie(()=>{v()});async function v(o){h.value=!0;const{data:e}=await Fe(o);C.value=e,h.value=!1}async function V(o){const e={...o};o.time&&o.time[0]&&o.time&&o.time[1]&&Object.assign(e,{startTime:o.time[0].format("YYYY-MM-DD HH:mm:ss"),endTime:o.time[1].format("YYYY-MM-DD HH:mm:ss")}),h.value=!0,await v(e)}const m=Y({selectedRowKeys:[],loading:!1}),j=de(()=>m.selectedRowKeys.length>0&&m.selectedRowKeys.length===1);function q(o){m.selectedRowKeys=o}const u=Y({open:!1,title:"",loading:!1});x();function N(o,e){if(e===0){U.confirm({title:"注意",icon:n(ke),content:`确定删除编号为 【${o.join(",")}】 的分类吗？`,okText:"确认",cancelText:"取消",onOk:()=>{$(o).then(f=>{f.code===200&&(g.success("删除成功"),m.selectedRowKeys=[],v())})}});return}$(o).then(f=>{f.code===200&&(g.success("删除成功"),m.selectedRowKeys=[],v())})}const i=x({id:void 0,reason:void 0,expiresTime:void 0}),s=Y({data:[],value:[],fetching:!1,isInsert:!1});async function D(o){o?(C.value.map(e=>(o===e.id&&(i.value.id=e.id,i.value.reason=e.reason,i.value.expiresTime=S(e.expiresTime)),null)),s.isInsert=!1):(i.value={id:void 0,reason:void 0,expiresTime:void 0},s.isInsert=!0),u.title="修改黑名单",u.open=!0}async function z(){if(u.loading=!0,i.value.id){let o={...i.value};o.expiresTime=S(i.value.expiresTime).format("YYYY-MM-DD HH:mm:ss"),await Ke(o).then(e=>{e.code===200&&(u.loading=!1,g.success("修改成功"))}).catch(e=>{g.warn(e),u.loading=!1})}else{let o={userIds:[],...i.value};o.expiresTime=S(i.value.expiresTime).format("YYYY-MM-DD HH:mm:ss"),s.value.map(e=>{o.userIds.push(e.value)}),console.log("添加",o),await Le(o).then(e=>{e.code===200&&(u.loading=!1,g.success("添加成功"))}).catch(e=>{g.warn(e),u.loading=!1})}await v()}let T=0;const E=ve(o=>{T+=1;const e=T;s.data=[],s.fetching=!0,Re({username:o}).then(f=>{e===T&&(s.data=f.data.map(r=>({label:r.username,value:r.id})),s.fetching=!1)})},300);return ue(s.value,()=>{s.data=[],s.fetching=!1}),(o,e)=>{const f=xe,r=we,A=he,R=be,F=Ie,J=b("PlusOutlined"),y=Ce,K=b("FileSyncOutlined"),L=b("DeleteOutlined"),W=b("VerticalAlignBottomOutlined"),X=De,G=Te,Q=Ye,Z=U,ee=Oe,M=Se,te=Be,ne=Ne,ae=le;return k(),w(ae,{"form-state":a(d),"onUpdate:refreshFunc":v,"onUpdate:onFinish":V},{"form-items":t(()=>[n(r,{label:"用户名称",name:"userName"},{default:t(()=>[n(f,{value:a(d).userName,"onUpdate:value":e[0]||(e[0]=l=>a(d).userName=l),placeholder:"请输入用户名称",style:{width:"150px"}},null,8,["value"])]),_:1}),n(r,{label:"封禁时间",name:"time"},{default:t(()=>[n(A,{value:a(d).time,"onUpdate:value":e[1]||(e[1]=l=>a(d).time=l),placeholder:["开始时间","结束时间"]},null,8,["value"])]),_:1}),n(r,{label:"封禁理由",name:"reason"},{default:t(()=>[n(f,{value:a(d).reason,"onUpdate:value":e[2]||(e[2]=l=>a(d).reason=l),placeholder:"请输入封禁理由",style:{width:"200px"}},null,8,["value"])]),_:1}),n(r,{label:"封禁类型",name:"type",style:{"margin-right":"1rem"}},{default:t(()=>[n(F,{style:{width:"7em"},placeholder:"封禁类型",value:a(d).type,"onUpdate:value":e[3]||(e[3]=l=>a(d).type=l)},{default:t(()=>[n(R,{value:1},{default:t(()=>[p(" 手动封禁 ")]),_:1}),n(R,{value:2},{default:t(()=>[p(" 自动封禁 ")]),_:1})]),_:1},8,["value"])]),_:1})]),"operate-btn":t(()=>[n(y,{type:"primary",onClick:e[4]||(e[4]=l=>D())},{icon:t(()=>[n(J)]),default:t(()=>[p(" 新增 ")]),_:1}),n(y,{class:"green",disabled:!a(j),onClick:e[5]||(e[5]=l=>D(a(m).selectedRowKeys[0]))},{icon:t(()=>[n(K)]),default:t(()=>[p(" 修改 ")]),_:1},8,["disabled"]),n(y,{type:"dashed",danger:"",ghost:"",disabled:!(a(m).selectedRowKeys.length>0),onClick:e[6]||(e[6]=l=>N(a(m).selectedRowKeys,0))},{icon:t(()=>[n(L)]),default:t(()=>[p(" 删除 ")]),_:1},8,["disabled"]),n(y,{class:"orange",onClick:e[7]||(e[7]=l=>a(g).warn("别点了，有空再写"))},{icon:t(()=>[n(W)]),default:t(()=>[p(" 导出 ")]),_:1})]),"table-content":t(()=>[n(Z,{open:a(u).open,"onUpdate:open":e[11]||(e[11]=l=>a(u).open=l),title:a(u).title,"confirm-loading":a(u).loading,width:"400px",onOk:z},{default:t(()=>[re(n(r,{label:"用户名称"},{default:t(()=>[n(F,{value:a(s).value,"onUpdate:value":e[8]||(e[8]=l=>a(s).value=l),mode:"multiple","label-in-value":"",placeholder:"搜索用户",style:{width:"100%"},"filter-option":!1,"not-found-content":a(s).fetching?void 0:null,options:a(s).data,onSearch:a(E)},ce({_:2},[a(s).fetching?{name:"notFoundContent",fn:t(()=>[n(X,{size:"small"})]),key:"0"}:void 0]),1032,["value","not-found-content","options","onSearch"])]),_:1},512),[[pe,a(s).isInsert]]),n(r,{label:"解封时间"},{default:t(()=>[n(G,{style:{width:"100%"},"show-time":"",value:a(i).expiresTime,"onUpdate:value":e[9]||(e[9]=l=>a(i).expiresTime=l),placeholder:"解封时间"},null,8,["value"])]),_:1}),n(r,{label:"封禁理由"},{default:t(()=>[n(Q,{showCount:!0,value:a(i).reason,"onUpdate:value":e[10]||(e[10]=l=>a(i).reason=l),placeholder:"请输入封禁理由",style:{width:"100%","max-height":"100px"}},null,8,["value"])]),_:1})]),_:1},8,["open","title","confirm-loading"]),n(ne,{columns:P,"data-source":a(C),loading:a(h),"row-selection":{selectedRowKeys:a(m).selectedRowKeys,onChange:q},"row-key":l=>l.id,size:"small"},{bodyCell:t(({column:l,record:c})=>[l.dataIndex==="type"?(k(),w(ee,{key:0,color:c.type==1?"#87d068":"#f50"},{default:t(()=>[p(I(c.type==1?"手动封禁":"自动封禁"),1)]),_:2},1032,["color"])):O("",!0),l.dataIndex==="userName"&&c.type==2?(k(),w(M,{key:1,title:"IP信息"},{content:t(()=>[B("div",Me,I(c.ipInfo),1)]),default:t(()=>[n(y,null,{default:t(()=>[p("查看IP信息")]),_:1})]),_:2},1024)):l.dataIndex==="reason"&&c.reason.length>10?(k(),w(M,{key:2,title:"封禁理由"},{content:t(()=>[p(I(c.reason),1)]),default:t(()=>[p(" "+I(c.reason.slice(0,10))+"... ",1)]),_:2},1024)):O("",!0),l.key==="operation"?(k(),me(_e,{key:3},[n(y,{type:"link",style:{padding:"0"},onClick:oe=>D(c.id)},{icon:t(()=>[n(K)]),default:t(()=>[Ue]),_:2},1032,["onClick"]),n(te,{title:"是否确定删除","ok-text":"Yes","cancel-text":"No",onConfirm:oe=>N([c.id])},{default:t(()=>[n(y,{type:"link",style:{padding:"0","margin-left":"5px"}},{icon:t(()=>[n(L)]),default:t(()=>[$e]),_:1})]),_:2},1032,["onConfirm"])],64)):l.key==="icon"?(k(),w(fe(c.icon),{key:4})):O("",!0)]),_:1},8,["data-source","loading","row-selection","row-key"])]),_:1},8,["form-state"])}}});export{Je as default};
