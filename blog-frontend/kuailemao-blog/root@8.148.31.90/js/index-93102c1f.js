import{A as se,r as f,B as oe,f as ne,aQ as re,Q as ie,o as v,c as w,q as l,l as t,y as s,x as m,u as a,aj as de,D as A,t as I,j as D,T as F,F as ue,E as d,H as me,I as fe,az as ce,as as _e,ab as pe,z as ve,ax as ge,aR as Ee,aS as ye,ay as be,ak as xe,aT as Ie,aK as Ve,aU as we,aV as ke,aM as O,aW as Re}from"./.pnpm-a60ec0da.js";import{_ as Ue}from"./index-898656d3.js";import{i as Te,n as Ae,o as Se,p as he,_ as Ce}from"./index-f983387b.js";import{s as Be}from"./index-2137e392.js";import"./index-ab0906f1.js";const Ne={class:"flex justify-center items-center"},je={class:"mt-6"},ze={class:"dialog-footer"},De={class:"md:mt-16 mt-10 2xl:w-[100rem] w-full flex md:flex-row flex-col justify-center"},Fe={class:"md:w-1/2 w-full"},Oe={class:"bg_card box_show w-full p-5 rounded shadow-slate-300"},Le={class:"flex justify-center mx-6"},Me={class:"w-full mb-5"},Pe={class:"flex justify-center"},$e=["src"],Ze={class:"flex justify-center"},qe={class:"bg_card box_show w-full p-5 mt-5 rounded shadow-slate-300 mb-28"},He={class:"flex justify-center"},Ke={class:"w-full mb-5"},Qe={class:"flex justify-center mx-6"},Ye={class:"flex w-full"},Ge={class:"md:ml-10 md:w-[20rem] w-full p-5",style:{"min-height":"20px"}},Je={key:0,class:"bg_card box_show rounded"},We={style:{"text-align":"center",padding:"15px 15px 10px 15px"}},Xe={style:{"font-weight":"bold"}},ea={style:{"font-size":"14px",color:"grey",padding:"10px"}},aa={key:0,class:"mt-5 p-3 bg_card box_show rounded"},L="http://192.168.182.128:9000/blog/user/avatar/default.png",la=se({__name:"index",setup(ta){const S=f(),u=f({nickname:"",gender:void 0,intro:"",avatar:""}),i=Te(),c=f(L),r=oe({email:"",code:"",password:""});function h(){C.value.validate(o=>{o?he(u.value).then(e=>{e.code==200?(d.success("信息更新成功"),i.getInfo()):d.error(e.data.msg)}):d.warning("请完整填写信息")})}const V=f(""),M=()=>{V.value!==c.value?S.value.submit():(u.value.avatar=L.trim(),h())},P={VITE_APP_BASE_API:"/api",VITE_SERVE:"",VITE_FRONTEND_URL:"",VITE_MUSIC_BASE_API:"/wapi",VITE_MUSIC_SERVE:"",VITE_MUSIC_FRONTEND_URL:"",VITE_YIYAN_API:"",VITE_ENABLE_DEV_TOOLSBLOCKER:"true",VITE_USER_NODE_ENV:"production",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_SERVE+"/api/user/auth/upload/avatar",$=localStorage.getItem("Token")||sessionStorage.getItem("Token")||"",Z=o=>{if(o.code!==200){d.error("头像上传失败！"+o.msg);return}u.value.avatar=o.data,h(),V.value=c.value},q=o=>(V.value=c.value,o.type!=="image/jpeg"&&o.type!=="image/png"?(d.error("头像图片需要jpg或者png类型的图片！！"),!1):o.size/1024/1024>2?(d.error("头像图片大小不能超过2MB！"),!1):!0),H=o=>{c.value=URL.createObjectURL(o.raw)};ne(()=>{re(()=>{i.userInfo&&(u.value=i.userInfo,c.value=i.userInfo.avatar,V.value=i.userInfo.avatar,r.email=i.userInfo.email)})});const K=(o,e,p)=>{e===""?p(new Error("请输入用户昵称")):/[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(e)?p():p(new Error("用户名不能包含特殊字符，只能是中/英文"))},C=f(),k=f(),Q={nickname:[{validator:K,trigger:["blur","change"]},{min:2,max:10,message:"用户昵称的长度必须在2-10个字符之间",trigger:["blur","change"]}]},Y={email:[{required:!0,message:"请输入邮件地址",trigger:"blur"},{type:"email",message:"请输入合法的电子邮件地址",trigger:["blur","change"]}],code:[{required:!0,message:"请输入获取的验证码",trigger:"blur"}]},g=f(!1);function G(){if(r.password===""){d.warning("密码不能为空");return}Ae(r).then(o=>{o.code==200?(d.success("邮件地址更新成功"),r.code="",i.getInfo(),g.value=!1):d.error(o.msg)})}function J(){k.value.validate(o=>{o?g.value=!0:d.warning("请完整填写信息")})}function W(){k.value.validate(o=>{o?(r.password="第三方登录",Se(r).then(e=>{e.code==200?(d.success("邮件地址更新成功"),r.code="",i.getInfo()):d.error(e.msg)})):d.warning("请完整填写信息")})}const B=ie(()=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r.email)),_=f(0);function X(){var o;if(r.email===((o=i.userInfo)==null?void 0:o.email)){d.warning("邮件地址未更改");return}B&&(_.value=60,Be(r.email,"resetEmail").then(e=>{if(e.code==200){d.success(`验证码已发送到邮箱：${r.email}，请注意查收`);const p=setInterval(()=>{_.value===0?clearInterval(p):_.value--},1e3)}else d.error(e.msg),_.value=0}))}return(o,e)=>{var j;const p=Ue,y=me,E=fe,ee=ce,R=_e,U=pe,ae=ve,b=ge,T=Ee,le=ye,N=be,te=xe;return v(),w(ue,null,[l(p),t("div",Ne,[l(ee,{modelValue:a(g),"onUpdate:modelValue":e[2]||(e[2]=n=>de(g)?g.value=n:null),title:"帐号安全验证",width:"500","align-center":""},{footer:s(()=>[t("div",ze,[l(E,{onClick:e[1]||(e[1]=n=>g.value=!1)},{default:s(()=>e[9]||(e[9]=[m("关闭")])),_:1}),l(E,{type:"primary",onClick:G,icon:a(Ie)},{default:s(()=>e[10]||(e[10]=[m(" 更新邮件 ")])),_:1},8,["icon"])])]),default:s(()=>[e[11]||(e[11]=t("span",{class:"font-bold"},"你正在进行敏感操作, 继续操作前请验证您的身份",-1)),t("div",je,[e[8]||(e[8]=t("span",{class:"font-bold"},"密码验证",-1)),l(y,{modelValue:a(r).password,"onUpdate:modelValue":e[0]||(e[0]=n=>a(r).password=n),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])])]),_:1},8,["modelValue"]),t("div",De,[t("div",Fe,[t("div",Oe,[t("div",null,[l(R,null,{default:s(()=>[l(a(Ve))]),_:1}),e[12]||(e[12]=t("span",{class:"font-bold text-xl ml-2"},"账号信息设置",-1))]),e[17]||(e[17]=t("span",{style:{color:"gray","font-size":"0.8rem"}},"在这里可以编辑你的个人信息，个人简介等等……",-1)),l(U,{style:{"margin-top":"0.5rem"}}),t("div",Le,[t("div",Me,[t("div",Pe,[l(ae,{class:"avatar-uploader",action:a(P),"show-file-list":!1,"on-success":Z,"before-upload":q,"on-change":H,headers:{Authorization:"Bearer "+JSON.parse(a($)).token},"auto-upload":!1,ref_key:"uploadRef",ref:S,name:"avatarFile"},{default:s(()=>[a(c)?(v(),w("img",{key:0,src:a(c),class:"avatar",alt:"请上传头像",style:{"border-radius":"50%"}},null,8,$e)):(v(),A(R,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[l(a(we))]),_:1}))]),_:1},8,["action","headers"])]),t("div",Ze,[l(N,{"label-position":"top","label-width":"auto",class:"w-full mt-5",model:a(u),ref_key:"baseFormRef",ref:C,rules:Q},{default:s(()=>[l(b,{label:"用户昵称",prop:"nickname"},{default:s(()=>[l(y,{placeholder:"请输入用户昵称",maxlength:"10",modelValue:a(u).nickname,"onUpdate:modelValue":e[3]||(e[3]=n=>a(u).nickname=n)},null,8,["modelValue"])]),_:1}),l(b,{label:"性别"},{default:s(()=>[l(le,{modelValue:a(u).gender,"onUpdate:modelValue":e[4]||(e[4]=n=>a(u).gender=n)},{default:s(()=>[l(T,{label:1},{default:s(()=>e[13]||(e[13]=[m("男")])),_:1}),l(T,{label:2},{default:s(()=>e[14]||(e[14]=[m("女")])),_:1}),l(T,{label:0},{default:s(()=>e[15]||(e[15]=[m("保密")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"个人简介"},{default:s(()=>[l(y,{type:"textarea",placeholder:"请输入个人简介",modelValue:a(u).intro,"onUpdate:modelValue":e[5]||(e[5]=n=>a(u).intro=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),l(E,{type:"success",icon:a(ke),onClick:M},{default:s(()=>e[16]||(e[16]=[m("更新信息")])),_:1},8,["icon"])])])]),t("div",qe,[t("div",null,[l(R,null,{default:s(()=>[l(a(O))]),_:1}),e[18]||(e[18]=t("span",{class:"font-bold text-xl ml-2"},"电子邮件设置",-1))]),e[21]||(e[21]=t("span",{style:{color:"gray","font-size":"0.8rem"}},"在这里可以修改或绑定的电子邮箱信息，绑定后可以开启邮箱提醒！",-1)),l(U,{style:{"margin-top":"0.5rem"}}),t("div",He,[t("div",Ke,[t("div",Qe,[l(N,{"label-position":"top","label-width":"auto",class:"w-full mt-5",model:a(r),ref_key:"emailFormRef",ref:k,rules:Y},{default:s(()=>[l(b,{label:"电子邮件",prop:"email"},{default:s(()=>[l(y,{placeholder:"请输入电子邮件",modelValue:a(r).email,"onUpdate:modelValue":e[6]||(e[6]=n=>a(r).email=n)},null,8,["modelValue"])]),_:1}),l(b,{prop:"code"},{default:s(()=>[t("div",Ye,[l(y,{placeholder:"请获取验证码",modelValue:a(r).code,"onUpdate:modelValue":e[7]||(e[7]=n=>a(r).code=n)},null,8,["modelValue"]),l(E,{type:"success",onClick:X,plain:"",class:"ml-2",disabled:!a(B)||a(_)!=0},{default:s(()=>[m(I(a(_)>0?`请稍后 ${a(_)} 秒`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"])]),((j=a(i).userInfo)==null?void 0:j.registerType)===0?(v(),A(E,{key:0,class:"mx-6",icon:a(Re),type:"success",onClick:J},{default:s(()=>e[19]||(e[19]=[m("安全验证")])),_:1},8,["icon"])):(v(),A(E,{key:1,class:"mx-6",icon:a(O),type:"success",onClick:W},{default:s(()=>e[20]||(e[20]=[m("确定")])),_:1},8,["icon"]))])])])]),t("div",Ge,[l(F,{name:"el-fade-in-linear"},{default:s(()=>{var n,x,z;return[a(i).userInfo?(v(),w("div",Je,[t("div",We,[l(te,{size:70,src:(n=a(i).userInfo)==null?void 0:n.avatar},null,8,["src"]),t("div",Xe," 你好，"+I((x=a(i).userInfo)==null?void 0:x.nickname),1),l(U,{style:{margin:"10px 0"}}),t("div",ea,I(((z=a(i).userInfo)==null?void 0:z.intro)||"这个用户很懒，没有填写个人简介~"),1)])])):D("",!0)]}),_:1}),l(F,{name:"el-fade-in-linear"},{default:s(()=>{var n,x;return[a(i).userInfo?(v(),w("div",aa,[e[22]||(e[22]=t("div",{class:"text-gray-400 font-bold"}," 欢迎加入Ruyu个人博客！ ",-1)),t("div",null,"注册时间："+I((n=a(i).userInfo)==null?void 0:n.createTime),1),t("div",null,"登录时间："+I((x=a(i).userInfo)==null?void 0:x.loginTime),1)])):D("",!0)]}),_:1})])])])],64)}}});const ua=Ce(la,[["__scopeId","data-v-f1b1e1f9"]]);export{ua as default};
