import{_ as ee}from"./index-0deb4903.js";import{t as te,n as ne,s as le,_ as ae}from"./index-2a334394.js";import{m as k,al as U,am as A,X as oe,Y as ie,S as se,y as de,an as ue,J as re,a0 as ce,as as pe}from"./antd-a1128520.js";import{d as _e,a as Y,r as N,o as me,a0 as z,a1 as c,a2 as y,a3 as l,c as a,u as n,a5 as b,F as B,ak as ve,E as u,ae as r,af as m,m as fe,a8 as e,a6 as ge,a7 as ye}from"./vue-5b89248e.js";import"./index.vue_vue_type_script_setup_true_lang-be6d18e9.js";import"./chunk-YXBPAIHU-f2871816.js";import"./context-6a3352c8.js";async function he(f,s){return te(`/log/list/${f}/${s}`).catch(T=>k.warn(T))}async function xe(f){return ne("/log/search",f).catch(s=>k.warn(s))}async function E(f){return le("/log/delete",{ids:f}).catch(s=>k.warn(s))}const _=f=>(ge("data-v-6cba09c6"),f=f(),ye(),f),be=_(()=>e("span",{style:{"margin-left":"0.2rem"}},"详细",-1)),ke=_(()=>e("span",{style:{"font-size":"1.2rem"}},"操作日志详细",-1)),we={class:"log-detail"},Ie=_(()=>e("label",null,"操作模块：",-1)),Ce=_(()=>e("label",null,"请求地址：",-1)),Se=_(()=>e("label",null,"登录信息：",-1)),Oe=_(()=>e("label",null,"请求方式：",-1)),Ne=_(()=>e("label",null,"操作方法：",-1)),De=_(()=>e("label",null," 请求参数： ",-1)),Te=_(()=>e("label",null,"返回参数：",-1)),Re=_(()=>e("label",null,"操作类型：",-1)),Ue=_(()=>e("label",null,"操作描述：",-1)),Ye={key:0},ze=_(()=>e("label",null,"异常信息：",-1)),Be=_(()=>e("label",null,"操作状态：",-1)),Me={key:0},$e={key:1},Ke={key:2},Le=_(()=>e("label",null,"消耗时间：",-1)),qe=_(()=>e("label",null,"操作时间：",-1)),Ae=_e({__name:"index",setup(f){const s=Y({ip:void 0,module:void 0,userName:void 0,operation:void 0,state:void 0,time:void 0}),T=[{title:"日志编号",dataIndex:"id",align:"center"},{title:"系统模块",dataIndex:"module",align:"center"},{title:"操作类型",dataIndex:"operation",align:"center"},{title:"操作人员",dataIndex:"userName",align:"center"},{title:"操作地址",dataIndex:"ip",align:"center"},{title:"操作地点",dataIndex:"address",align:"center"},{title:"操作状态",dataIndex:"state",align:"center"},{title:"操作日期",dataIndex:"loginTime",align:"center"},{title:"消耗时间",dataIndex:"time",align:"center"},{title:"操作",dataIndex:"operate",align:"center"}],D=N(!1),w=N([]),M=N();me(()=>{I()});function F(i){S.selectedRowKeys=i}function P(i){U.confirm({title:"注意",icon:a(A),content:`确定删除编号为 【${i.join(",")}】 的登录日志吗？`,okText:"确认",cancelText:"取消",onOk:()=>{E(i).then(t=>{t.code===200&&(k.success("删除成功"),S.selectedRowKeys=[],I())})}})}function V(){if(!w||w.value.length===0){k.warn("没有能清空的登录日志");return}const i=w.value.map(t=>t.id);U.confirm({title:"注意",icon:a(A),content:"是否要清空所有操作日志？",okText:"确认",cancelText:"取消",onOk:()=>{E(i).then(t=>{t.code===200&&(k.success("清空成功"),I())})}})}const C=N(!1);function $(){C.value=!1}const d=N({module:void 0,operation:void 0,method:void 0,userName:void 0,exception:void 0,ip:void 0,reqParameter:void 0,address:void 0,reqAddress:void 0,reqMapping:void 0,state:0,loginTime:void 0,time:void 0,returnParameter:void 0,description:void 0});function j(i){w.value.map(t=>(t.id===i&&(d.value=t),null)),C.value=!0}const g=Y({total:0,current:1,pageSize:10});function H(i){g.current=i.current,g.pageSize=i.pageSize,Object.values(s).every(t=>t===void 0)&&I(),K(s)}async function I(i){D.value=!0;let t;if(i)t=i;else{const{data:p}=await he(g.current,g.pageSize);p&&p.page.length>0&&(M.value=Array.from(new Set(p.page.map(h=>h.operation)))),t=p.page,g.total=p.total}t.map(p=>p.status=p.status===0),w.value=t,D.value=!1}async function K(i){const t={...i,current:g.current,pageSize:g.pageSize};i.time&&i.time[0]&&Object.assign(t,{logTimeStart:i.time[0].format("YYYY-MM-DD HH:mm:ss")}),i.time&&i.time[1]&&Object.assign(t,{logTimeEnd:i.time[1].format("YYYY-MM-DD HH:mm:ss")}),D.value=!0;const{data:p}=await xe(t);g.total=p.total,await I(p.page)}const S=Y({selectedRowKeys:[],loading:!1});return(i,t)=>{const p=oe,h=ie,R=se,L=de,G=ue,q=z("DeleteOutlined"),O=re,J=z("VerticalAlignBottomOutlined"),v=ce,X=z("EyeOutlined"),Q=pe,W=U,Z=ee;return c(),y(Z,{"form-state":n(s),"onUpdate:refreshFunc":I,"onUpdate:onFinish":K},{"form-items":l(()=>[a(h,{label:"操作地址",name:"ip"},{default:l(()=>[a(p,{value:n(s).ip,"onUpdate:value":t[0]||(t[0]=o=>n(s).ip=o),placeholder:"请输入操作地址",style:{width:"250px"}},null,8,["value"])]),_:1}),a(h,{label:"系统模块",name:"module"},{default:l(()=>[a(p,{value:n(s).module,"onUpdate:value":t[1]||(t[1]=o=>n(s).module=o),placeholder:"请输入系统模块",style:{width:"250px"}},null,8,["value"])]),_:1}),a(h,{label:"操作人员",name:"userName"},{default:l(()=>[a(p,{value:n(s).userName,"onUpdate:value":t[2]||(t[2]=o=>n(s).userName=o),placeholder:"请输入操作人员",style:{width:"250px"}},null,8,["value"])]),_:1}),a(h,{label:"类型",name:"operation",style:{"margin-left":"1.8rem"}},{default:l(()=>[a(L,{value:n(s).operation,"onUpdate:value":t[3]||(t[3]=o=>n(s).operation=o),placeholder:"操作类型",style:{width:"250px"}},{default:l(()=>[(c(!0),b(B,null,ve(n(M),o=>(c(),y(R,{key:o,value:o},{default:l(()=>[u(r(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(h,{label:"状态",name:"state",style:{"margin-left":"1.8rem"}},{default:l(()=>[a(L,{value:n(s).state,"onUpdate:value":t[4]||(t[4]=o=>n(s).state=o),placeholder:"操作状态",style:{width:"250px"}},{default:l(()=>[a(R,{value:0},{default:l(()=>[u(" 成功 ")]),_:1}),a(R,{value:1},{default:l(()=>[u(" 失败 ")]),_:1})]),_:1},8,["value"])]),_:1}),a(h,{label:"操作时间",name:"time"},{default:l(()=>[a(G,{value:n(s).time,"onUpdate:value":t[5]||(t[5]=o=>n(s).time=o),placement:"topLeft",placeholder:["开始时间","结束时间"],style:{width:"250px"}},null,8,["value"])]),_:1})]),"operate-btn":l(()=>[a(O,{type:"dashed",danger:"",ghost:"",disabled:!(n(S).selectedRowKeys.length>0),onClick:t[6]||(t[6]=o=>P(n(S).selectedRowKeys))},{icon:l(()=>[a(q)]),default:l(()=>[u(" 删除 ")]),_:1},8,["disabled"]),a(O,{type:"primary",danger:"",ghost:"",onClick:t[7]||(t[7]=o=>V())},{icon:l(()=>[a(q)]),default:l(()=>[u(" 清空 ")]),_:1}),a(O,{class:"orange",onClick:t[8]||(t[8]=o=>n(k).warn("别点了，有空再写"))},{icon:l(()=>[a(J)]),default:l(()=>[u(" 导出 ")]),_:1})]),"table-content":l(()=>[a(Q,{columns:T,"data-source":n(w),loading:n(D),"row-selection":{selectedRowKeys:n(S).selectedRowKeys,onChange:F},"row-key":o=>o.id,size:"small",pagination:{total:n(g).total},onChange:H},{bodyCell:l(({column:o,record:x})=>[o.dataIndex==="userName"?(c(),b(B,{key:0},[x.userName==="unknown-1702606997"?(c(),y(v,{key:0,color:"pink"},{default:l(()=>[u(" 未知 ")]),_:1})):m("",!0)],64)):m("",!0),o.dataIndex==="operation"?(c(),y(v,{key:1,color:x.operation!=="删除"?"orange":"red"},{default:l(()=>[u(r(x.operation),1)]),_:2},1032,["color"])):m("",!0),o.dataIndex==="time"?(c(),y(v,{key:2,color:"blue"},{default:l(()=>[u(r(x.time)+"毫秒 ",1)]),_:2},1024)):m("",!0),o.dataIndex==="state"?(c(),b(B,{key:3},[x.state===0?(c(),y(v,{key:0,color:"#87d068"},{default:l(()=>[u(" 成功 ")]),_:1})):m("",!0),x.state===1?(c(),y(v,{key:1,color:"#f50"},{default:l(()=>[u(" 失败 ")]),_:1})):m("",!0),x.state===2?(c(),y(v,{key:2,color:"#a46244"},{default:l(()=>[u(" 异常 ")]),_:1})):m("",!0)],64)):m("",!0),o.dataIndex==="operate"?(c(),y(O,{key:4,type:"link",onClick:Ee=>j(x.id)},{icon:l(()=>[a(X)]),default:l(()=>[be]),_:2},1032,["onClick"])):m("",!0)]),_:1},8,["data-source","loading","row-selection","row-key","pagination"]),a(W,{open:n(C),"onUpdate:open":t[9]||(t[9]=o=>fe(C)?C.value=o:null),width:"900px",onCancel:$},{footer:l(()=>[a(O,{onClick:$},{default:l(()=>[u(" 关闭 ")]),_:1})]),title:l(()=>[ke]),default:l(()=>[e("div",we,[e("div",null,[e("div",null,[Ie,e("div",null,r(n(d).module),1)]),e("div",null,[Ce,e("div",null,r(n(d).reqAddress),1)])]),e("div",null,[e("div",null,[Se,e("div",null,r(n(d).userName)+" / "+r(n(d).ip)+" / "+r(n(d).address),1)]),e("div",null,[Oe,e("div",null,r(n(d).reqMapping),1)])]),e("div",null,[e("div",null,[Ne,e("div",null,r(n(d).method),1)])]),e("div",null,[e("div",null,[De,e("div",null,r(n(d).reqParameter),1)])]),e("div",null,[e("div",null,[Te,e("div",null,r(n(d).returnParameter),1)])]),e("div",null,[e("div",null,[Re,e("div",null,[a(v,{color:"orange"},{default:l(()=>[u(r(n(d).operation),1)]),_:1})])]),e("div",null,[Ue,e("div",null,r(n(d).description),1)])]),e("div",null,[n(d).state===2?(c(),b("div",Ye,[ze,e("div",null,r(n(d).exception),1)])):m("",!0)]),e("div",null,[e("div",null,[Be,n(d).state===0?(c(),b("div",Me,[a(v,{color:"#87d068"},{default:l(()=>[u(" 成功 ")]),_:1})])):m("",!0),n(d).state===1?(c(),b("div",$e,[a(v,{color:"#f50"},{default:l(()=>[u(" 失败 ")]),_:1})])):m("",!0),n(d).state===2?(c(),b("div",Ke,[a(v,{color:"#a46244"},{default:l(()=>[u(" 异常 ")]),_:1})])):m("",!0)]),e("div",null,[Le,e("div",null,[a(v,{color:"blue"},{default:l(()=>[u(r(n(d).time)+"毫秒 ",1)]),_:1})])]),e("div",null,[qe,e("div",null,r(n(d).loginTime),1)])])])]),_:1},8,["open"])]),_:1},8,["form-state"])}}});const Xe=ae(Ae,[["__scopeId","data-v-6cba09c6"]]);export{Xe as default};
