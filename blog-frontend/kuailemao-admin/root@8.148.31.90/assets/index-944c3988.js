import{u as C,a as M,b as N}from"./index-73aceca2.js";import{c as k}from"./CompressedImage-dc0d9ea8.js";import{aw as J,ad as R,ae as D,m as p,ag as z,X as V,Y as E,J as G,H as T,U as $}from"./antd-a1128520.js";import{d as H,a as X,r as v,a1 as _,a5 as w,c as e,a3 as l,a8 as d,a2 as h,u,E as g,a6 as Y,a7 as q}from"./vue-5b89248e.js";import{_ as K}from"./index-2a334394.js";const U=m=>(Y("data-v-bb558f1c"),m=m(),q(),m),Q={class:"info"},W={class:"avatar"},Z=["src"],ee={key:1},ae=U(()=>d("div",{class:"ant-upload-text"}," 头像上传 ",-1)),te={style:{display:"flex"}},oe=U(()=>d("div",{style:{"font-size":"12px",color:"grey"}}," 图片资源上传与保存按钮无关 ",-1)),se={style:{display:"flex","justify-content":"center"}},ne=H({__name:"index",props:{info:{type:Object}},emits:["reset:stationmaster:info"],setup(m,{emit:L}){const x=L,t=X(m.info);function I(a){return new Promise((o,r)=>{const i=new FileReader;i.readAsDataURL(a),i.onload=()=>o(i.result),i.onerror=s=>r(s)})}const B=v([]),b=v(!1),f=v(),y=v([]);if(t.webmasterAvatar&&t.webmasterProfileBackground){f.value=t.webmasterAvatar;const o=new URL(t.webmasterProfileBackground).pathname.split("/").pop();y.value=[{thumbUrl:t.webmasterProfileBackground,name:o}]}async function A(a){if(b.value=!0,!(a.type==="image/jpeg"||a.type==="image/png"||a.type==="image/webp")){p.error("文件格式必须是jpg或png或webp");return}const r=await k(a);if(!(r.size/1024/1024<.3)){p.error("图片压缩后大小必须小于 0.3MB");return}await I(a).then(n=>{f.value=n,b.value=!1});const s=new FormData;return s.append("avatar",r,r.name),C(s).then(n=>{n.code===200?p.success("头像上传成功"):p.error(`头像上传失败：${n.msg}`)}),!1}async function P(a){if(!(a.type==="image/jpeg"||a.type==="image/png"||a.type==="image/webp")){p.error("文件格式必须是jpg或png或webp");return}const r=await k(a);if(!(r.size/1024/1024<.3)){p.error("图片压缩后大小必须小于 0.3MB");return}const s=new FormData;return s.append("background",r,r.name),M(s).then(n=>{n.code===200?(y.value=[{thumbUrl:n.data,name:new URL(n.data).pathname.split("/").pop()}],p.success("资料卡背景图上传成功")):p.error(`资料卡背景图上传失败：${n.msg}`)}),!1}function F(){N(t).then(a=>{a.code===200&&p.success("保存成功")})}function O(){x("reset:stationmaster:info")}return(a,o)=>{const r=z,i=V,s=E,n=G,S=T,j=$;return _(),w("div",Q,[e(j,null,{default:l(()=>[d("div",W,[e(r,{"file-list":B.value,name:"avatar","list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,"before-upload":A},{default:l(()=>[f.value?(_(),w("img",{key:0,src:f.value,alt:"avatar"},null,8,Z)):(_(),w("div",ee,[b.value?(_(),h(u(J),{key:0})):(_(),h(u(R),{key:1})),ae]))]),_:1},8,["file-list"])]),e(s,{label:"名称"},{default:l(()=>[e(i,{value:u(t).webmasterName,"onUpdate:value":o[0]||(o[0]=c=>u(t).webmasterName=c)},null,8,["value"])]),_:1}),e(s,{label:"文案"},{default:l(()=>[e(i,{value:u(t).webmasterCopy,"onUpdate:value":o[1]||(o[1]=c=>u(t).webmasterCopy=c)},null,8,["value"])]),_:1}),e(s,{label:"背景"},{default:l(()=>[d("div",null,[e(r,{"file-list":y.value,"list-type":"picture",name:"background","show-upload-list":{showRemoveIcon:!1},"before-upload":P,"max-count":1},{default:l(()=>[d("div",te,[e(n,null,{default:l(()=>[e(u(D)),g(" 背景上传 ")]),_:1})])]),_:1},8,["file-list"]),oe])]),_:1}),e(S,null,{default:l(()=>[g("相关链接")]),_:1}),e(s,{label:"Github"},{default:l(()=>[e(i,{value:u(t).githubLink,"onUpdate:value":o[2]||(o[2]=c=>u(t).githubLink=c)},null,8,["value"])]),_:1}),e(s,{label:"Gitee  "},{default:l(()=>[e(i,{value:u(t).giteeLink,"onUpdate:value":o[3]||(o[3]=c=>u(t).giteeLink=c)},null,8,["value"])]),_:1}),d("div",se,[e(n,{type:"primary",onClick:F,style:{"margin-right":"1rem"}},{default:l(()=>[g(" 保存 ")]),_:1}),e(n,{type:"default",onClick:O},{default:l(()=>[g(" 重置 ")]),_:1})])]),_:1})])}}});const de=K(ne,[["__scopeId","data-v-bb558f1c"]]);export{de as default};
